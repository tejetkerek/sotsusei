<!DOCTYPE html>
<html lang="ja" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>海外レシート管理マスター - 新規会員登録</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.4.19/dist/full.min.css" rel="stylesheet" type="text/css" />
    
    <!-- Firebase SDK -->
    <script type="module" src="firebase-config.js"></script>
    <script src="navigation.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'custom-blue': '#3B82F6',
                        'custom-gray': '#6B7280'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-base-100 min-h-screen">
    <div class="min-h-screen bg-gray-100">
        <div class="w-full bg-white min-h-screen">
            <!-- ナビゲーションヘッダー（動的に生成される） -->
            
            <div class="px-3 py-4 sm:px-4 sm:py-6 pt-16 pb-16">
                <!-- ヘッダー -->
                <div class="text-center mb-6">
                    <h1 class="text-lg sm:text-xl font-bold text-gray-800">会員登録（無料）</h1>
                    <p class="text-xs sm:text-sm text-gray-600 mt-2">アカウントを作成して、より便利にご利用いただけます</p>
                    
                </div>

                <!-- 登録フォーム -->
                <div class="bg-white rounded-lg border border-gray-200 p-3 sm:p-4 space-y-3 sm:space-y-4">
                    <!-- ニックネーム -->
                    <div>
                        <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">ニックネーム</label>
                        <input type="text" class="input input-bordered w-full border-gray-300 text-xs sm:text-sm" placeholder="例: たなか">
                    </div>

                    <!-- 性別 -->
                    <div>
                        <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">性別</label>
                        <div class="flex flex-wrap gap-2 sm:gap-4">
                            <label class="flex items-center">
                                <input type="radio" name="gender" value="male" class="radio radio-primary mr-1 sm:mr-2">
                                <span class="text-xs sm:text-sm whitespace-nowrap">男性</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="gender" value="female" class="radio radio-primary mr-1 sm:mr-2">
                                <span class="text-xs sm:text-sm whitespace-nowrap">女性</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="gender" value="other" class="radio radio-primary mr-1 sm:mr-2">
                                <span class="text-xs sm:text-sm whitespace-nowrap">回答したくない</span>
                            </label>
                        </div>
                    </div>

                    <!-- 生年月日 -->
                    <div>
                        <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">生年月日</label>
                        <div class="grid grid-cols-3 gap-1 sm:gap-2">
                            <select class="select select-bordered border-gray-300 text-xs sm:text-sm">
                                <option>年</option>
                                <option>1990</option>
                                <option>1991</option>
                                <option>1992</option>
                                <option>1993</option>
                                <option>1994</option>
                                <option>1995</option>
                                <option>1996</option>
                                <option>1997</option>
                                <option>1998</option>
                                <option>1999</option>
                                <option>2000</option>
                            </select>
                            <select class="select select-bordered border-gray-300 text-xs sm:text-sm">
                                <option>月</option>
                                <option>1</option>
                                <option>2</option>
                                <option>3</option>
                                <option>4</option>
                                <option>5</option>
                                <option>6</option>
                                <option>7</option>
                                <option>8</option>
                                <option>9</option>
                                <option>10</option>
                                <option>11</option>
                                <option>12</option>
                            </select>
                            <select class="select select-bordered border-gray-300 text-xs sm:text-sm">
                                <option>日</option>
                                <option>1</option>
                                <option>2</option>
                                <option>3</option>
                                <option>4</option>
                                <option>5</option>
                                <option>6</option>
                                <option>7</option>
                                <option>8</option>
                                <option>9</option>
                                <option>10</option>
                                <option>11</option>
                                <option>12</option>
                                <option>13</option>
                                <option>14</option>
                                <option>15</option>
                                <option>16</option>
                                <option>17</option>
                                <option>18</option>
                                <option>19</option>
                                <option>20</option>
                                <option>21</option>
                                <option>22</option>
                                <option>23</option>
                                <option>24</option>
                                <option>25</option>
                                <option>26</option>
                                <option>27</option>
                                <option>28</option>
                                <option>29</option>
                                <option>30</option>
                                <option>31</option>
                            </select>
                        </div>
                    </div>

                    <!-- メールアドレス -->
                    <div>
                        <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">メールアドレス（ログインIDとなります）</label>
                        <input type="email" class="input input-bordered w-full border-gray-300 text-xs sm:text-sm" placeholder="example@email.com" autocomplete="off">
                    </div>

                    <!-- チェックボックス -->
                    <div class="bg-gray-50 rounded-lg p-2 sm:p-3">
                        <label class="flex items-center">
                            <input type="checkbox" class="checkbox checkbox-primary mr-2 sm:mr-3">
                            <span class="text-xs text-gray-600">
                                プロダクトリリース等の案内を受け取る
                            </span>
                        </label>
                    </div>

                    <!-- パスワード -->
                    <div>
                        <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">パスワード</label>
                        <div class="relative">
                            <input type="password" id="passwordInput" class="input input-bordered w-full border-gray-300 pr-8 sm:pr-10 text-xs sm:text-sm" placeholder="8文字以上（大文字・小文字・数字を含む）" autocomplete="new-password">
                            <button type="button" id="togglePassword" class="absolute right-2 sm:right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700">
                                <svg id="eyeIcon" class="h-4 w-4 sm:h-5 sm:w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                </svg>
                            </button>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">8文字以上で、大文字・小文字・数字を含む必要があります</p>
                    </div>

                    <!-- パスワード確認 -->
                    <div>
                        <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-1 sm:mb-2">パスワード確認</label>
                        <div class="relative">
                            <input type="password" id="confirmPasswordInput" class="input input-bordered w-full border-gray-300 pr-8 sm:pr-10 text-xs sm:text-sm" placeholder="パスワードを再入力してください" autocomplete="new-password">
                            <button type="button" id="toggleConfirmPassword" class="absolute right-2 sm:right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700">
                                <svg id="eyeIconConfirm" class="h-4 w-4 sm:h-5 sm:w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>


                <!-- 登録ボタン -->
                <div class="mt-6 sm:mt-8">
                    <button id="registerBtn" class="btn bg-amber-600 hover:bg-amber-700 text-white btn-block border-0 text-sm sm:text-base" onclick="handleRegister()">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                        </svg>
                        <span class="whitespace-nowrap">会員登録する</span>
                    </button>
                    
                </div>

                <!-- エラーメッセージ表示エリア -->
                <div id="errorMessage" class="mt-3 sm:mt-4 p-2 sm:p-3 bg-red-100 border border-red-300 rounded-lg text-red-700 text-xs sm:text-sm hidden">
                </div>

                <!-- 成功メッセージ表示エリア -->
                <div id="successMessage" class="mt-3 sm:mt-4 p-2 sm:p-3 bg-green-100 border border-green-300 rounded-lg text-green-700 text-xs sm:text-sm hidden">
                </div>

                <!-- ログインリンク -->
                <div class="text-center mt-3 sm:mt-4">
                    <span class="text-xs sm:text-sm text-gray-600">すでにアカウントをお持ちの方は</span>
                    <a href="login.html" class="text-xs sm:text-sm text-blue-600 hover:text-blue-700 ml-1">こちらからログイン</a>
                </div>
            </div>
            </div>
        </div>
    </div>

    <script type="module">
        // Firebase関数を動的にインポート
        let registerUser = null;
        
        // Firebase関数を読み込み
        async function loadFirebaseFunctions() {
            try {
                const firebaseModule = await import('./firebase-config.js');
                registerUser = firebaseModule.registerUser;
                console.log('Firebase関数の読み込み完了');
            } catch (error) {
                console.error('Firebase関数の読み込みエラー:', error);
            }
        }
        
        // ページ読み込み時にFirebase関数を読み込み
        loadFirebaseFunctions();
        
        // 登録処理（グローバル関数として定義）
        window.handleRegister = function() {
            const email = document.querySelector('input[type="email"]').value;
            const password = document.querySelector('input[type="password"]').value;
            const confirmPassword = document.querySelectorAll('input[type="password"]')[1].value;
            
            // エラーメッセージをクリア
            hideMessages();
            
            // バリデーション
            if (!email || !password || !confirmPassword) {
                showError('すべての項目を入力してください。');
                return;
            }
            
            if (password !== confirmPassword) {
                showError('パスワードが一致しません。');
                return;
            }
            
            if (password.length < 8) {
                showError('パスワードは8文字以上で入力してください。');
                return;
            }
            
            // 登録ボタンを無効化
            const registerBtn = document.getElementById('registerBtn');
            registerBtn.disabled = true;
            registerBtn.innerHTML = '<span class="loading loading-spinner loading-sm"></span> 登録中...';
            
            // Firebase関数が読み込まれているかチェック
            if (!registerUser) {
                showError('Firebase関数が読み込まれていません。ページを再読み込みしてください。');
                registerBtn.disabled = false;
                registerBtn.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                    </svg>
                    会員登録する
                `;
                return;
            }
            
            // Firebase認証で登録
            registerUser(email, password)
                .then((user) => {
                    showSuccess('会員登録が完了しました！ログイン画面に移動します...');
                    console.log('登録成功:', user);
                    // 3秒後にログイン画面に遷移
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 3000);
                })
                .catch((error) => {
                    console.error('登録エラー:', error);
                    let errorMessage = '登録に失敗しました。';
                    
                    switch (error.code) {
                        case 'auth/email-already-in-use':
                            errorMessage = 'このメールアドレスは既に使用されています。';
                            break;
                        case 'auth/invalid-email':
                            errorMessage = '有効なメールアドレスを入力してください。';
                            break;
                        case 'auth/weak-password':
                            errorMessage = 'パスワードが弱すぎます。より強力なパスワードを設定してください。';
                            break;
                    }
                    
                    showError(errorMessage);
                })
                .finally(() => {
                    // 登録ボタンを有効化
                    registerBtn.disabled = false;
                    registerBtn.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                        </svg>
                        会員登録する
                    `;
                });
        }
        
        // メッセージを非表示
        window.hideMessages = function() {
            document.getElementById('errorMessage').classList.add('hidden');
            document.getElementById('successMessage').classList.add('hidden');
        }
        
        // エラーメッセージ表示
        window.showError = function(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
        }
        
        // 成功メッセージ表示
        window.showSuccess = function(message) {
            const successDiv = document.getElementById('successMessage');
            successDiv.textContent = message;
            successDiv.classList.remove('hidden');
        }

        // デバッグ関数
        window.debugFirebase = function() {
            console.log('=== Firebase デバッグ情報 ===');
            console.log('registerUser関数:', registerUser);
            console.log('Firebase関数の型:', typeof registerUser);
            
            if (registerUser) {
                showSuccess('✅ Firebase関数が正常に読み込まれています');
            } else {
                showError('❌ Firebase関数が読み込まれていません');
            }
        }

        // パスワード表示/非表示機能
        document.addEventListener('DOMContentLoaded', function() {
            // パスワード表示/非表示ボタン
            const togglePassword = document.getElementById('togglePassword');
            const passwordInput = document.getElementById('passwordInput');
            const eyeIcon = document.getElementById('eyeIcon');

            togglePassword.addEventListener('click', function() {
                if (passwordInput.type === 'password') {
                    passwordInput.type = 'text';
                    eyeIcon.innerHTML = `
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21" />
                    `;
                } else {
                    passwordInput.type = 'password';
                    eyeIcon.innerHTML = `
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                    `;
                }
            });

            // パスワード確認表示/非表示ボタン
            const toggleConfirmPassword = document.getElementById('toggleConfirmPassword');
            const confirmPasswordInput = document.getElementById('confirmPasswordInput');
            const eyeIconConfirm = document.getElementById('eyeIconConfirm');

            toggleConfirmPassword.addEventListener('click', function() {
                if (confirmPasswordInput.type === 'password') {
                    confirmPasswordInput.type = 'text';
                    eyeIconConfirm.innerHTML = `
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21" />
                    `;
                } else {
                    confirmPasswordInput.type = 'password';
                    eyeIconConfirm.innerHTML = `
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                    `;
                }
            });
        });
    </script>
</body>
</html>
